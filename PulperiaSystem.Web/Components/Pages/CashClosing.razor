@page "/cash-closing/{UsuarioId:int}"
@rendermode InteractiveServer

<PageTitle>Cierre de Caja</PageTitle>

<div class="container mt-3" style="max-width: 600px;">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>ðŸ”’ Cierre de Turno</h3>
        <a href="/dashboard/@UsuarioId" class="btn btn-outline-secondary btn-sm">Volver</a>
    </div>

    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="alert alert-danger">@ErrorMessage</div>
    }

    @if (!string.IsNullOrEmpty(SuccessMessage))
    {
        <div class="alert alert-success">@SuccessMessage</div>
    }

    @if (IsLoading)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p>Verificando caja...</p>
        </div>
    }
    else if (HasActiveSession)
    {
        <div class="card shadow mb-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Resumen del Turno</h5>
                <small>Iniciado: @_sesion?.FechaInicio.ToString("dd/MM HH:mm")</small>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush mb-3">
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Fondo Inicial:</span>
                        <strong>@MontoInicial.ToString("C2")</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Ventas Efectivo:</span>
                        <strong>+ @TotalVentas.ToString("C2")</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between bg-light">
                        <strong>Total Esperado:</strong>
                        <strong class="text-primary">@TotalEsperado.ToString("C2")</strong>
                    </li>
                </ul>

                <hr />

                <div class="mb-3">
                    <label class="form-label fw-bold">Dinero Real en Caja (Corte Ciego)</label>
                    <div class="input-group input-group-lg">
                        <span class="input-group-text">$</span>
                         <input type="number" step="0.01" class="form-control fw-bold" 
                                @bind="MontoReal" @bind:event="oninput" />
                    </div>
                </div>

                @if (MontoReal > 0)
                {
                    <div class="alert @(Diferencia == 0 ? "alert-success" : (Diferencia > 0 ? "alert-info" : "alert-warning")) text-center">
                        <strong>Diferencia: @Diferencia.ToString("C2")</strong>
                        <br/>
                        <small>@(Diferencia == 0 ? "Â¡Cuadre Perfecto!" : (Diferencia > 0 ? "Sobrante" : "Faltante"))</small>
                    </div>
                }

                <button class="btn btn-danger w-100 btn-lg mt-2" @onclick="CerrarTurno">
                    ðŸ”’ Cerrar Caja y Salir
                </button>
            </div>
        </div>
    }
</div>
